\chapter{Data, integrasjon og infrastruktur}

\section{L\ae ringsm\aa l}
\begin{itemize}
    \item Beskrive arkitekturen for datafangst, lagring og distribusjon i digitale tvillinger.
    \item Evaluere integrasjonsm\o nstre og standarder.
    \item Utforme krav til sikkerhet, personvern og datasuverenitet.
\end{itemize}

\section{Dataflyt og pipeline-design}
En digital tvilling er avhengig av en gjennomtenkt datapipeline som kan fange, bearbeide og tilgjengeliggj\o re informasjon med riktig kvalitet og tidsoppl\o sning. Det starter i feltet, hvor sensorer, styringssystemer eller manuelle registreringer skaper r\aa data. Dataene m\aa filtreres og normaliseres tidlig for \aa unng\aa store forsinkelser senere i kjeden. Norske industrimilj\o er som prosessindustrien p\aa Her\o ya har gode erfaringer med \aa kombinere edge-noder som gj\o r grunnleggende forh\aa ndsprosessering med sentrale skyplattformer som tilbyr datalagring, modelltrening og visualisering.

Figur~\ref{fig:kap3-datapipeline} oppsummerer hovedstr\o mmen fra feltniv\aa til de applikasjonene som konsumerer tvillingtjenestene. Integrasjonslaget markerer overgangen der normaliserte hendelser og masterdata eksponeres gjennom standardiserte grensesnitt og meldingsstrukturer, slik at etterf\o lgende plattformer kan bygges modul\ae rt.

% Alt-tekst: support/figurer/metadata/kap03-datapipeline-v2.alt.md
\begin{figure}[ht]
    \centering
    \resizebox{\textwidth}{!}{%
    \begin{tikzpicture}[node distance=2.3cm, >=LaTeX]
        \tikzset{
            stage/.style={
                draw=grafitt,
                rounded corners=4pt,
                minimum height=1.9cm,
                text width=3.2cm,
                align=center,
                font=\small,
                fill=#1!18
            },
            stage/.default=dypblaa
        }
        \node (field) [stage=dypblaa] {Feltniv\aa \\ \footnotesize Sensorer, SCADA, operat\o rinput};
        \node (edge) [stage=petrol, right=2.3cm of field] {Edge- og gatewaylag \\ \footnotesize Filtrering, buffering, protokollkonvertering};
        \node (integration) [stage=havgronn, right=2.3cm of edge] {Integrasjonslag \\ \footnotesize Meldingsk\o er, API-orkestrering, semantisk modellering};
        \node (platform) [stage=solgul, right=2.3cm of integration] {Data- og analyseplattformer \\ \footnotesize Datasj\o, tidsserielager, modelltrening};
        \node (apps) [stage=koral, right=2.3cm of platform] {Forbrukere \\ \footnotesize Digital tvilling, dashboards, styringssystemer};
        \draw[->, thick, draw=grafitt] (field) -- (edge);
        \draw[->, thick, draw=grafitt] (edge) -- node[above, font=\scriptsize]{Normalisering, kvalitetssikring} (integration);
        \draw[->, thick, draw=grafitt] (integration) -- node[above, font=\scriptsize]{Distribusjon, standarder} (platform);
        \draw[->, thick, draw=grafitt] (platform) -- node[above, font=\scriptsize]{Innsikt, automatisering} (apps);
        \node (governance) [draw=grafitt, dashed, rounded corners=4pt, text width=8cm, align=center, font=\scriptsize, fill=skygraa!60, below=1.4cm of integration] {Tverrg\aa ende styring: tilgangskontroll, hendelseslogging, datakatalog og livssyklus for modeller};
        \draw[->, dashed, draw=grafitt] (governance.north west) -- (edge.south);
        \draw[->, dashed, draw=grafitt] (governance.north) -- (integration.south);
        \draw[->, dashed, draw=grafitt] (governance.north east) -- (platform.south);
    \end{tikzpicture}%
    }
    \caption{Skisse av datapipeline fra felt til applikasjoner, med integrasjonslaget som kobler sanntidsstr\o mmer og dataplattformer.}
    \label{fig:kap3-datapipeline}
\end{figure}

\subsection{Fra sensor til innsikt}
F\o rste steg er datainnsamling via feltbuss, industrielle IoT-gatewayer eller API-er fra eksterne systemer. For digital tvilling-bruk er det avgj\o rende \aa definere sampling-rate, datastruktur og kontekst slik at hver m\a ling kan kobles til riktig fysiske komponent. Inntaksleddet m\aa h\aa ndtere buffring n\aar tilkoblingen faller ut, og bidra med enhetlige tidsstempler for \aa muliggj\o re felles analyse av hendelser. Videre b\o r pipeline-design inkludere datakvalitetsregler som fanger opp avvik, for eksempel ved \aa merke data fra kalibreringsperioder eller vedlikehold.

\subsection{Batch kontra streaming}
Batchbehandling er egnet n\aar dataene hovedsakelig brukes til periodisk rapportering eller modelloppdatering, mens streaming er n\o dvendig for operasjonelle beslutninger og avviksh\a ndtering. Mange virksomheter kombinerer disse to: hendelser str\o mmes gjennom en meldingsk\o for \aa trigge alarmer og dashboards, samtidig som dataene landes i et datasj\o for tyngre analyser senere. Beslutningen b\o r dokumenteres i arkitekturbeskrivelsen slik at teamet vet hvilke forsinkelser og kostnader som forventes.

\subsection{Metadata, semantikk og masterdata}
Semantisk informasjon er n\o kkelen til \aa kunne dele data p\aa tvers av applikasjoner. Et felles begrepsapparat, for eksempel basert p\aa internasjonale referansemodeller eller bransjespesifikke ontologier, hjelper teamet med \aa unng\aa tolkningstvister. Masterdata om utstyr, prosesser og lokasjoner m\a holdes oppdatert, ellers mister tvillingen sin kobling til den fysiske virkeligheten. Ved \aa etablere en dedikert katalog med API-tilgang kan andre prosjekter gjenbruke informasjonen og bidra til kvaliteten.

\section{Integrasjonsm\o nstre og standarder}
Et integrasjonslandskap for digitale tvillinger spenner fra enkle API-kall til kompleks hendelsesdrevet samhandling. God praksis er \aa kartlegge datastr\o mmer, volum og krav til robusthet f\o r man velger teknologier.

\subsection{Arkitekturvalg}
Tradisjonelle REST-API-er gir tydelig kontraktstyring og passer for foresp\o rsel-/svar-scenarioer, men b\o r suppleres med publish/subscribe-mekanismer n\aar flere systemer trenger de samme sanntidsdataene. Hendelsesdrevne arkitekturer med meldingsk\oer eller loggstr\o mmer (for eksempel Apache Kafka) gir bedre skalerbarhet og kan forenkle revisjon, fordi alle hendelser lagres i riktig rekkef\o lge. For kritiske styringssystemer b\o r man ogs\aa vurdere redundans og fallback-l\o sninger, slik at tapte meldinger ikke medf\o rer sikkerhetsrisiko.

\subsection{Standarder i norsk praksis}
OPC UA er utbredt i norsk industri fordi det forener datapublisering med semantiske modeller. MQTT er lettere og passer godt n\aar batteri- eller nettverkshensyn krever minimal overhead, som i maritime anvendelser. Asset Administration Shell (AAS) f\aa r st\o tte gjennom europeiske initiativer og gir et strukturert format for \aa beskrive digitale representasjoner av produkter og systemer. Ved \aa kombinere disse standardene kan man b\o de integrere eldre automasjonssystemer og dele data med eksterne partnere.

\subsection{Datakvalitet og interoperabilitet}
Integrasjonen m\aa inkludere kontrollpunkter for datakvalitet, spesielt n\aar dataene brukes til modelloppdatering eller automatiserte beslutninger. Versjonering av datakontrakter og testmilj\o er der integrasjoner valideres f\o r produksjonssetting reduserer risiko for feil. Dokumentasjon av avhengigheter og kontaktpunkter gj\o r det enklere \aa etablere ansvar for h\a ndtering av databrudd eller uforutsette endringer.

\section{Infrastruktur og sikkerhet}
Arkitekturen b\o r balansere behovet for lav responstid med kravene til sikkerhet, kostnad og etterlevelse. Norske organisasjoner m\o ter ofte krav om datasuverenitet, samtidig som de \o nsker \aa dra nytte av skytjenester for elastisitet og tung regnekraft.

\subsection{Edge, sky og hybrid}
Edge-plattformer n\a r fysiske prosesser gir rask respons og reduserer b\aa ndebreddebruken ved \aa filtrere data f\o r videresending. Skybaserte løsninger gir tilgang til avanserte analysetjenester og fleksibel lagring. En hybrid tilnærming er vanlig: modellene trenes i skyen og pakkes som containere som kan distribueres tilbake til fabrikkgulvet. God orkestrering (for eksempel med Kubernetes eller Azure Arc) sikrer at oppdateringer kan rulles ut kontrollert.

\subsection{Tilgangsstyring og zero-trust-prinsipper}
Zero-trust inneb\ae rer at alle foresp\o rsler autentiseres og autoriseres, uansett hvor de kommer fra. I en digital tvilling m\a dette omfatte sensorer, API-klienter og mennesker. Bruk av identitetsplattformer, automatisert n\o kkellagring og segmenterte nettverk reduserer angrepsflaten. Logsikkerhet, inkludert kryptografisk signering av hendelser, hjelper virksomheten med \aa dokumentere etterlevelse og spore hendelser i etterkant.

\subsection{Juridiske hensyn}
GDPR krever at personopplysninger behandles med tydelig hjemmel og strenge tilgangsregler. Selv n\a r dataene i utgangspunktet er tekniske, kan kombinasjonen av sensorinformasjon og arbeidsplaner gj\o re dem identifiserbare. Datasuverenitet har f\aa tt \o kt fokus etter Schrems II-dommen; virksomheter m\aa vite hvor dataene fysisk lagres og hvilke underleverand\o rer som involveres. Mange velger \aa knytte seg til norske eller europeiske skyer, eller \aa bruke konfigurerbare sovereign cloud-l\o sninger.

\section{Datastyring og kontinuerlig forbedring}
For \aa sikre at datapipelinen leverer konsistent kvalitet m\aa tekniske tiltak kobles til tydelige roller og arbeidsprosesser. Norske virksomheter etablerer ofte et datastyringsforum som samler produkteier, data steward, sikkerhetsansvarlig og representanter fra drift. Forumet prioriterer tiltak basert p\aa indikatorer for datakvalitet, hendelseslogger og fagfelleinnspill.

\subsection{Roller og m\o tearenaer}
\begin{itemize}
    \item \textbf{Data steward:} Overv\aa ker datakvalitet og initierer korrigerende tiltak n\aa r regler brytes, for eksempel ved \aa sende saker til endringsstyret eller oppdatere datakontrakter.
    \item \textbf{Produkteier for tvillingen:} Sikrer at hendelser med h\o y forretningsrisiko f\o lges opp og at prioriteringene synkroniseres med gevinstplaner i Kapittel~7.
    \item \textbf{Teknisk plattformteam:} Forvalter overv\aa kingsdashbord, versjonering av dataprosesser og automatiserte tester som kj\o res hver gang datastrukturer endres.
\end{itemize}
Forumet kan m\o tes ukentlig i innf\o ringsfasen og deretter m\aa nedlig for moden drift. Referat og tiltak registreres i fagfelleloggen (DI-03) slik at status er synlig for hele redaksjonen.

\subsection{Operasjonelle kontrollpunkter}
\begin{enumerate}
    \item \textbf{Datakvalitetsdashbord:} Visualiserer fullstendighet, tidsforsinkelser og valideringsfeil for hver datastr\o m. Alarmgrenser defineres i samarbeid med domeneeksperter og dokumenteres i styringspakken til Kapittel~6.
    \item \textbf{Hendelsesrespons:} Avvik loggf\o res i samme system som sikkerhetshendelser. Hvert avvik f\aa r ansvarlig person, frist og forslag til kompenserende tiltak (for eksempel fallback-modell eller manuelt kontrollsteg).
    \item \textbf{L\ae ringssl\o yfe:} Kvartalsvise retrospektiv analyserer m\o nstre i datakvalitetsavvik og oppdaterer pipeline-design eller oppl\ae ringsprogram for operat\o rer.
\end{enumerate}
Detaljert praksis for indikatorene, m\o tesstruktur og l\ae ringssl\o yfe er nedfelt i delingsnotatet `support/notater/datastyringsforum-di03.md`,
som deles med fagfeller i arbeidet med kommentar DI-03.

\subsection{Samsvar med personvern og etikk}
N\aa r nye datakilder tas i bruk b\o r datastyringsforumet sjekke behandlingsgrunnlag, vurdering av dataminimering og rutiner for sletting. Et eget sjekkpunkt sikrer at dokumentasjonen speiler kravene fra Helsedirektoratet, Normen og Kapittel~6 om validering og tillit. N\aa r tvillingen skaleres p\aa tvers av anlegg, anbefales det \aa utvide datakatalogen med tydelige beskrivelser av form\aa l og kontaktpunkt for hvert datasett.

\section{Refleksjonssp\o rsm\aa l og \o vinger}
\begin{enumerate}
    \item Tegn et dataflytdiagram for en digital tvilling i en norsk industribedrift.
    \item Vurder n\aar det er hensiktsmessig \aa bruke sky kontra edge for sanntidsanalyse.
    \item Beskriv hvordan du ville etablere en governance-modell for datatilgang.
    \item Foresl\aa indikatorer for datakvalitet som b\o r overv\aa kes kontinuerlig i tvillingen.
\end{enumerate}
